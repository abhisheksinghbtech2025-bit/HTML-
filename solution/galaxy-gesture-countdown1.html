<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Galaxy Gesture Zoom</title>
<style>
  body { margin:0; overflow:hidden; background:black; }
  canvas { display:block; width:100%; height:100%; }
  video {
    position:fixed;
    right:5px;
    bottom:5px;
    width:120px;
    opacity:0.25;
    z-index:5;
  }
  #overlay {
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-size:120px;
    font-family:Arial;
    background:black;
    z-index:10;
  }
  #info {
    position:fixed;
    top:10px;
    left:10px;
    color:lime;
    font-family:monospace;
    z-index:10;
  }
</style>
</head>
<body>

<div id="overlay">3</div>
<div id="info">Show thumb + index</div>
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js"></script>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const video = document.getElementById("video");
const info = document.getElementById("info");
const overlay = document.getElementById("overlay");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

/* â±ï¸ COUNTDOWN */
let count = 3;
let started = false;
setInterval(() => {
  if(count>0) overlay.innerText = count--;
  else if(count===0){
    overlay.innerText="START";
    count--;
    setTimeout(()=>{ overlay.style.display="none"; started=true; },700);
  }
},1000);

/* ðŸŒŒ ZOOM + ROTATION */
let zoom = 1, smoothZoom=1, rotation=0, rotationSpeed=0;

/* ðŸŒŒ DENSE COLORED NEBULA SPIRAL GALAXY */
const stars=[];
const STAR_COUNT=3500;

for(let i=0;i<STAR_COUNT;i++){
  const r = Math.random()**0.25*canvas.width*0.45;
  const angle1=Math.random()*Math.PI*2;
  const angle2=Math.random()*Math.PI;
  const hue = 220 + Math.random()*80;

  stars.push({
    x:r*Math.cos(angle1)*Math.sin(angle2),
    y:r*Math.sin(angle1)*Math.sin(angle2),
    z:r*Math.cos(angle2),
    color:`hsl(${hue},100%,70%)`,
    spiralOffset: Math.random()*Math.PI*2
  });
}

/* ðŸŽ¨ DRAW LOOP */
function draw(){
  requestAnimationFrame(draw);
  if(!started) return;

  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  rotation += rotationSpeed;

  for(let s of stars){
    // spiral rotation effect
    const spiral = 0.002 * s.spiralOffset + 0.001 * s.z;
    const rx = s.x * Math.cos(rotation + spiral) - s.z * Math.sin(rotation + spiral);
    const rz = s.x * Math.sin(rotation + spiral) + s.z * Math.cos(rotation + spiral);

    const scale = smoothZoom * (600/(rz+600));
    const x = rx*scale + canvas.width/2;
    const y = s.y*scale + canvas.height/2;
    const r = scale*1.6;

    if(x<0||x>canvas.width||y<0||y>canvas.height) continue;

    // glow/bloom effect
    const gradient = ctx.createRadialGradient(x,y,r*2,x,y,0);
    gradient.addColorStop(0,s.color);
    gradient.addColorStop(1,"rgba(255,255,255,0)");
    ctx.fillStyle=gradient;
    ctx.beginPath();
    ctx.arc(x,y,r*1.2,0,Math.PI*2);
    ctx.fill();
  }

  smoothZoom += (zoom - smoothZoom)*0.15;
}
draw();

/* âœ‹ HAND TRACKING */
const hands = new Hands({ locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/${f}`});
hands.setOptions({ maxNumHands:1, modelComplexity:0, minDetectionConfidence:0.6, minTrackingConfidence:0.6 });

hands.onResults(res=>{
  if(!res.multiHandLandmarks.length){ info.innerText="No hand"; return; }
  const h=res.multiHandLandmarks[0];
  const thumb=h[4], index=h[8], wrist=h[0];

  // ðŸŸ¢ debug dots
  h.forEach(p=>{
    ctx.beginPath();
    ctx.arc(p.x*canvas.width,p.y*canvas.height,3,0,Math.PI*2);
    ctx.fillStyle="lime";
    ctx.fill();
  });

  // ðŸ¤ ZOOM
  const dx=(thumb.x-index.x)*canvas.width;
  const dy=(thumb.y-index.y)*canvas.height;
  let dist=Math.sqrt(dx*dx+dy*dy);
  dist=Math.max(30,Math.min(dist,220));
  zoom=((dist-30)/(220-30))*7+0.4;

  // âœ‹ HAND TILT â†’ ROTATION SPEED
  const tilt = (index.x - wrist.x);
  rotationSpeed = tilt*0.08;

  info.innerText="Zoom:"+zoom.toFixed(2)+" | Rotation:"+rotationSpeed.toFixed(2);
});

/* ðŸ“± MOBILE CAMERA */
const camera = new Camera(video,{
  onFrame:async()=>{ await hands.send({image:video}); },
  width:640, height:480, facingMode:"environment"
});
camera.start();
</script>

</body>
</html>
